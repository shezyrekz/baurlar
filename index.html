<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Шежіре</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f6f1d1;
    overflow: hidden;
  }
  header {
    background: #26a69a;
    color: white;
    height: 55px;
    display: flex;
    align-items: center;
    padding: 0 18px;
    gap: 22px;
    position: relative;
    z-index: 10;
  }
  header .icon {
    cursor: pointer;
    font-size: 26px;
    user-select: none;
    transition: transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  header .icon:hover {
    transform: scale(1.1);
  }
  #tree-container {
    position: absolute;
    top: 55px;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
    background: #f6f1d1;
  }
  #tree {
    width: 100%;
    height: 100%;
  }
  .node circle {
    cursor: pointer;
    fill: #a1c2bb;
    stroke: #456d61;
    stroke-width: 1.5px;
  }
  .node text {
    font-size: 14px;
    pointer-events: none;
    user-select: none;
    fill: #333;
  }
  .link {
    fill: none;
    stroke: #456d61;
    stroke-width: 2px;
  }
  .floating-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #ff9800;
    color: white;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    font-size: 36px;
    line-height: 56px;
    text-align: center;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    user-select: none;
    z-index: 100;
  }
  .controls {
    position: fixed;
    top: 70px;
    right: 20px;
    z-index: 100;
    background: white;
    padding: 10px;
    border-radius: 5px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  }
  .controls button {
    display: block;
    margin: 5px 0;
    padding: 8px 12px;
    background: #26a69a;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
  }
</style>
</head>
<body>

<header>
  <div class="icon" title="Люди"><i class="fas fa-users"></i></div>
  <div class="icon" title="Поиск"><i class="fas fa-search"></i></div>
  <div class="icon" title="Добавить"><i class="fas fa-user-plus"></i></div>
  <div class="icon" title="Помощь"><i class="fas fa-question-circle"></i></div>
  <div class="icon" title="Статистика"><i class="fas fa-chart-bar"></i></div>
</header>

<div id="tree-container">
  <svg id="tree"></svg>
</div>

<div class="controls">
  <button onclick="resetView()">Сбросить вид</button>
  <button onclick="zoomIn()">Увеличить</button>
  <button onclick="zoomOut()">Уменьшить</button>
</div>

<div class="floating-btn" title="Добавить узел">+</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  const treeData = {
    name: "Алаш",
    children: [
      { name: "Ұлы жүз",
        children: [
          { name: "Қаны" },
          { name: "Шанышқылы" },
          { name: "Сіргелі" },
          { name: "Шақшам" },
          { name: "Сарүйсін", children: [
            { name: "Қалша" },
            { name: "Жақып" }
          ] },
          { name: "Шапырашты" },
          { name: "Жалайыр (600-700)" },
          { name: "Ысты" },
          { name: "Ошақты" },
          { name: "Албан" },
          { name: "Суан" },
          { name: "Дулат" }
        ]
      },
      { name: "Орта жүз" },
      { name: "Кіші жүз" },
      { name: "Жүзден тыс" }
    ]
  };

  const container = document.getElementById('tree-container');
  const width = container.clientWidth;
  const height = container.clientHeight;

  const svg = d3.select("#tree")
    .attr("width", width)
    .attr("height", height);

  // Создаем группу для масштабирования и панорамирования
  const g = svg.append("g");
  
  // Настройка масштабирования и панорамирования
  const zoom = d3.zoom()
    .scaleExtent([0.1, 3])
    .on("zoom", (event) => {
      g.attr("transform", event.transform);
    });

  svg.call(zoom);

  // Функции для управления
  function resetView() {
    svg.transition().duration(750).call(
      zoom.transform,
      d3.zoomIdentity.translate(width/2 - 200, 50).scale(1)
    );
  }

  function zoomIn() {
    svg.transition().duration(300).call(zoom.scaleBy, 1.3);
  }

  function zoomOut() {
    svg.transition().duration(300).call(zoom.scaleBy, 0.7);
  }

  const treeLayout = d3.tree().size([height - 100, width - 200]);

  let root = d3.hierarchy(treeData);
  
  // Сразу разворачиваем все узлы
  root.each(d => {
    if (d.children) {
      d._children = null; // Убираем возможность сворачивания
    }
  });

  root.x0 = height / 2;
  root.y0 = width / 4;

  update(root);

  function update(source) {
    const treeData = treeLayout(root);

    const nodes = treeData.descendants();
    const links = treeData.links();

    // Увеличиваем расстояние между уровнями
    nodes.forEach(d => {
      d.y = d.depth * 250; // Увеличено расстояние
      d.x = d.x * 0.8 + 50; // Корректируем вертикальное положение
    });

    // Очищаем предыдущее дерево
    g.selectAll("*").remove();

    // Рисуем связи
    const link = g.selectAll('path.link')
      .data(links)
      .enter()
      .append('path')
      .attr("class", "link")
      .attr('d', d => diagonal(d.source, d.target));

    // Рисуем узлы
    const node = g.selectAll('g.node')
      .data(nodes)
      .enter()
      .append('g')
      .attr('class', 'node')
      .attr("transform", d => `translate(${d.y},${d.x})`);

    node.append('circle')
      .attr('r', 20)
      .attr('fill', "#69b3a2")
      .attr('stroke', '#456d61')
      .attr('stroke-width', 2);

    node.append('text')
      .attr("dy", 5)
      .attr("x", d => d.children ? -25 : 25)
      .style("text-anchor", d => d.children ? "end" : "start")
      .text(d => d.data.name);

    // Автоматически центрируем вид
    setTimeout(() => {
      const bounds = g.node().getBBox();
      const dx = bounds.width;
      const dy = bounds.height;
      const x = (width - dx) / 2 - bounds.x;
      const y = (height - dy) / 2 - bounds.y;
      
      svg.transition().duration(750).call(
        zoom.transform,
        d3.zoomIdentity.translate(x, y).scale(1)
      );
    }, 100);
  }

  function diagonal(s, d) {
    return `M ${s.y} ${s.x}
            C ${(s.y + d.y) / 2} ${s.x},
              ${(s.y + d.y) / 2} ${d.x},
              ${d.y} ${d.x}`;
  }
</script>

</body>
</html>
