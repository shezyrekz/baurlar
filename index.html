<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–®–µ–∂—ñ—Ä–µ</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f6f1d1;
  }
  header {
    background: #26a69a;
    color: white;
    height: 55px;
    display: flex;
    align-items: center;
    padding: 0 18px;
    gap: 22px;
  }
  header .icon {
    cursor: pointer;
    font-size: 26px;
    user-select: none;
    transition: transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  header .icon:hover {
    transform: scale(1.1);
  }
  #tree-container {
    width: 100%;
    height: calc(100vh - 55px);
    overflow: auto;
    background: #f6f1d1;
  }
  /* –£–ó–ï–õ - –∫—Ä—É–∂–æ–∫ + —Ç–µ–∫—Å—Ç –≤ –æ–¥–Ω–æ–º —Ñ–æ–Ω–µ */
  .node-group {
    cursor: pointer;
    transition: all 0.5s ease;
  }
  
  /* –§–û–ù –¥–ª—è –∫—Ä—É–∂–∫–∞ –∏ —Ç–µ–∫—Å—Ç–∞ */
  .node-background {
    fill: white;
    stroke: #456d61;
    stroke-width: 2px;
    rx: 25px;
    ry: 25px;
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
  }
  
  .node-background.collapsed {
    stroke: #4CAF50;
  }
  
  .node-background.expanded {
    stroke: #26a69a;
  }
  
  /* –ö–†–£–ñ–û–ö */
  .node-circle {
    fill: white;
    stroke: inherit;
    stroke-width: 3px;
  }
  
  /* –ò–ö–û–ù–ö–ê –í –ö–†–£–ñ–ö–ï */
  .node-icon {
    font-size: 14px;
    text-anchor: middle;
    dominant-baseline: central;
    pointer-events: none;
    user-select: none;
    fill: #456d61;
    font-weight: bold;
  }
  
  /* –¢–ï–ö–°–¢ –°–ü–†–ê–í–ê –û–¢ –ö–†–£–ñ–ö–ê */
  .node-text {
    font-size: 14px;
    pointer-events: none;
    user-select: none;
    fill: #333;
    font-weight: bold;
    text-anchor: start;
    dominant-baseline: central;
  }
  
  .link {
    fill: none;
    stroke: #456d61;
    stroke-width: 2px;
    transition: all 0.5s ease;
    opacity: 0.8;
  }
  
  .floating-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #ff9800;
    color: white;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    font-size: 36px;
    line-height: 56px;
    text-align: center;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    user-select: none;
    z-index: 100;
  }
</style>
</head>
<body>

<header>
  <div class="icon" title="–õ—é–¥–∏"><i class="fas fa-users"></i></div>
  <div class="icon" title="–ü–æ–∏—Å–∫"><i class="fas fa-search"></i></div>
  <div class="icon" title="–î–æ–±–∞–≤–∏—Ç—å"><i class="fas fa-user-plus"></i></div>
  <div class="icon" title="–ü–æ–º–æ—â—å"><i class="fas fa-question-circle"></i></div>
  <div class="icon" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"><i class="fas fa-chart-bar"></i></div>
</header>

<div id="tree-container"></div>

<div class="floating-btn" title="–î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª">+</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  let i = 0;
  
  const treeData = {
    name: "–ê–ª–∞—à",
    children: [
      { name: "“∞–ª—ã –∂“Ø–∑",
        children: [
          { name: "“ö–∞–Ω—ã" },
          { name: "–®–∞–Ω—ã—à“õ—ã–ª—ã" },
          { name: "–°—ñ—Ä–≥–µ–ª—ñ" },
          { name: "–®–∞“õ—à–∞–º" },
          { name: "–°–∞—Ä“Ø–π—Å—ñ–Ω", children: [
            { name: "“ö–∞–ª—à–∞" },
            { name: "–ñ–∞“õ—ã–ø" }
          ] },
          { name: "–®–∞–ø—ã—Ä–∞—à—Ç—ã" },
          { name: "–ñ–∞–ª–∞–π—ã—Ä (600-700)" },
          { name: "–´—Å—Ç—ã" },
          { name: "–û—à–∞“õ—Ç—ã" },
          { name: "–ê–ª–±–∞–Ω" },
          { name: "–°—É–∞–Ω" },
          { name: "–î—É–ª–∞—Ç" }
        ]
      },
      { name: "–û—Ä—Ç–∞ –∂“Ø–∑" },
      { name: "–ö—ñ—à—ñ –∂“Ø–∑" },
      { name: "–ñ“Ø–∑–¥–µ–Ω —Ç—ã—Å" }
    ]
  };

  const width = window.innerWidth;
  const height = window.innerHeight - 55;
  
  const svg = d3.select("#tree-container")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

  const g = svg.append("g")
    .attr("transform", `translate(${width/2 - 100}, 150)`);

  const treeLayout = d3.tree().size([height - 200, width - 300]);

  let root = d3.hierarchy(treeData);
  
  function collapse(d) {
    if (d.children) {
      d._children = d.children;
      d._children.forEach(collapse);
      d.children = null;
    }
  }
  
  // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ —É–∑–ª—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  if (root.children) {
    root.children.forEach(collapse);
  }
  
  root.x0 = 0;
  root.y0 = 0;

  update(root);

  function update(source) {
    const duration = 400;
    
    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–µ—Ä–µ–≤–æ —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
    const tree = treeLayout(root);
    const nodes = tree.descendants();
    const links = tree.links();

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏
    nodes.forEach(d => {
      d.y = d.depth * 250;
    });

    // ====== –£–ó–õ–´ ======
    const node = g.selectAll('g.node-group')
      .data(nodes, d => d.id || (d.id = ++i));

    // –£–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤
    const nodeExit = node.exit()
      .transition()
      .duration(duration)
      .attr("transform", d => `translate(${source.y},${source.x})`)
      .style("opacity", 0)
      .remove();

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —É–∑–ª–æ–≤
    const nodeEnter = node.enter()
      .append('g')
      .attr('class', 'node-group')
      .attr("transform", d => `translate(${source.y0},${source.x0})`)
      .style("opacity", 0)
      .on('click', function(event, d) {
        event.stopPropagation();
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ: —Å–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å
        if (d.children) {
          // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–µ—Ç–∏ - —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
          d._children = d.children;
          d.children = null;
        } else if (d._children) {
          // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –¥–µ—Ç–∏ - —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
          d.children = d._children;
          d._children = null;
        }
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–µ—Ä–µ–≤–æ
        update(d);
      });

    // –§–û–ù
    nodeEnter.append('rect')
      .attr('class', d => `node-background ${d._children ? 'collapsed' : 'expanded'}`)
      .attr('x', -30)
      .attr('y', -25)
      .attr('width', 0)
      .attr('height', 50);

    // –ö—Ä—É–∂–æ–∫
    nodeEnter.append('circle')
      .attr('class', 'node-circle')
      .attr('cx', 0)
      .attr('cy', 0)
      .attr('r', 0);

    // –ò–∫–æ–Ω–∫–∞ –≤ –∫—Ä—É–∂–∫–µ
    nodeEnter.append('text')
      .attr('class', 'node-icon')
      .attr('x', 0)
      .attr('y', 0)
      .text(d => {
        if (d.depth === 0) return 'üëë';
        if (d.depth === 1) return '‚≠ê';
        if (d._children) return '‚ûï'; // –°–≤–µ—Ä–Ω—É—Ç–æ
        if (d.children) return '‚ûñ'; // –†–∞–∑–≤–µ—Ä–Ω—É—Ç–æ
        return 'üë§'; // –ù–µ—Ç –¥–µ—Ç–µ–π
      })
      .style('opacity', 0);

    // –¢–µ–∫—Å—Ç
    nodeEnter.append('text')
      .attr('class', 'node-text')
      .attr('x', 25)
      .attr('y', 0)
      .text(d => d.data.name)
      .style('opacity', 0);

    // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ —É–∑–ª—ã
    const nodeUpdate = nodeEnter.merge(node);

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
    nodeUpdate.transition()
      .duration(duration)
      .attr("transform", d => `translate(${d.y},${d.x})`)
      .style("opacity", 1);

    // –ê–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞
    nodeUpdate.select('.node-background')
      .transition()
      .duration(duration)
      .attr('width', function() {
        const text = this.parentNode.querySelector('.node-text');
        const textLength = text ? text.getComputedTextLength() : 0;
        return Math.max(120, textLength + 60);
      })
      .attr('class', d => `node-background ${d._children ? 'collapsed' : 'expanded'}`)
      .style('stroke', d => d._children ? '#4CAF50' : '#26a69a');

    // –ê–Ω–∏–º–∞—Ü–∏—è –∫—Ä—É–∂–∫–∞
    nodeUpdate.select('.node-circle')
      .transition()
      .duration(duration)
      .attr('r', 20)
      .style('stroke', d => d._children ? '#4CAF50' : '#26a69a');

    // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏
    nodeUpdate.select('.node-icon')
      .transition()
      .duration(duration)
      .style('opacity', 1)
      .text(d => {
        if (d.depth === 0) return 'üëë';
        if (d.depth === 1) return '‚≠ê';
        if (d._children) return '‚ûï';
        if (d.children) return '‚ûñ';
        return 'üë§';
      });

    // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
    nodeUpdate.select('.node-text')
      .transition()
      .duration(duration)
      .style('opacity', 1)
      .attr('x', 25);

    // ====== –°–í–Ø–ó–ò ======
    const link = g.selectAll('path.link')
      .data(links, d => d.target.id);

    // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–≤—è–∑–µ–π
    const linkExit = link.exit()
      .transition()
      .duration(duration)
      .style("opacity", 0)
      .remove();

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–≤—è–∑–µ–π
    const linkEnter = link.enter()
      .append('path')
      .attr("class", "link")
      .attr('d', d => diagonal(d.source, d.target))
      .style("opacity", 0);

    // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–≤—è–∑–∏
    const linkUpdate = linkEnter.merge(link);

    // –ê–Ω–∏–º–∞—Ü–∏—è —Å–≤—è–∑–µ–π
    linkUpdate.transition()
      .duration(duration)
      .attr('d', d => diagonal(d.source, d.target))
      .style("opacity", 1);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–π –∞–Ω–∏–º–∞—Ü–∏–∏
    nodes.forEach(d => {
      d.x0 = d.x;
      d.y0 = d.y;
    });
  }

  function diagonal(s, d) {
    // –°–æ–µ–¥–∏–Ω—è–µ–º –æ—Ç –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—è —Ä–æ–¥–∏—Ç–µ–ª—è –∫ –ª–µ–≤–æ–º—É –∫—Ä–∞—é —Ä–µ–±–µ–Ω–∫–∞
    const sourceX = s.y + (s.data.name ? s.data.name.length * 8 + 60 : 100);
    const targetX = d.y - 30;
    
    const path = d3.path();
    path.moveTo(sourceX, s.x);
    path.bezierCurveTo(
      (sourceX + targetX) / 2, s.x,
      (sourceX + targetX) / 2, d.x,
      targetX, d.x
    );
    return path.toString();
  }
  
  // –ö–Ω–æ–ø–∫–∞ +
  d3.select(".floating-btn").on("click", function() {
    alert("–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —É–∑–µ–ª");
  });
  
  // –ò–∫–æ–Ω–∫–∏ –≤ header
  d3.selectAll("header .icon").on("click", function() {
    const title = this.getAttribute("title");
    console.log("–ù–∞–∂–∞—Ç–∞ –∏–∫–æ–Ω–∫–∞:", title);
  });
</script>

</body>
</html>
