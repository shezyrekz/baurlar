<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>–®–µ–∂—ñ—Ä–µ</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f6f1d1;
    -webkit-text-size-adjust: 100%;
    touch-action: manipulation;
  }
  
  header {
    background: #26a69a;
    color: white;
    height: 55px;
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 12px;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  
  header .icon {
    cursor: pointer;
    font-size: 22px;
    user-select: none;
    transition: transform 0.2s, opacity 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
    border-radius: 8px;
    flex: 1;
    min-width: 40px;
  }
  
  header .icon:hover {
    transform: scale(1.05);
    background: rgba(255, 255, 255, 0.1);
  }
  
  header .icon.active {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
  }
  
  /* –ö–û–ù–¢–ï–ô–ù–ï–†–´ –î–õ–Ø –†–ê–ó–ù–´–• –°–ï–ö–¶–ò–ô */
  .section {
    display: none;
    width: 100%;
    height: calc(100vh - 55px);
    padding: 15px;
    box-sizing: border-box;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .section.active {
    display: block;
  }
  
  /* –°–ï–ö–¶–ò–Ø –õ–Æ–î–ò (–î–ï–†–ï–í–û) */
  #people-section {
    background: #f6f1d1;
    padding: 10px 5px;
  }
  
  /* –°–ï–ö–¶–ò–Ø –ü–û–ò–°–ö */
  #search-section {
    background: #f6f1d1;
  }
  
  .search-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 15px;
  }
  
  .search-box {
    width: 100%;
    padding: 14px 18px;
    font-size: 16px;
    border: 2px solid #26a69a;
    border-radius: 25px;
    margin-bottom: 20px;
    box-sizing: border-box;
    -webkit-appearance: none;
  }
  
  .search-results {
    background: white;
    border-radius: 12px;
    padding: 18px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  
  .result-item {
    padding: 14px 12px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    font-size: 15px;
    line-height: 1.4;
  }
  
  .result-item:active {
    background: #f0f9f7;
  }
  
  /* –°–ï–ö–¶–ò–Ø –î–û–ë–ê–í–ò–¢–¨ */
  #add-section {
    background: #f6f1d1;
  }
  
  .add-form {
    max-width: 100%;
    margin: 0 auto;
    background: white;
    padding: 22px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  
  .form-group {
    margin-bottom: 18px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 6px;
    color: #333;
    font-weight: 600;
    font-size: 15px;
  }
  
  .form-group input,
  .form-group select {
    width: 100%;
    padding: 14px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    box-sizing: border-box;
    -webkit-appearance: none;
  }
  
  .form-group input:focus,
  .form-group select:focus {
    border-color: #26a69a;
    outline: none;
  }
  
  .submit-btn {
    background: #26a69a;
    color: white;
    border: none;
    padding: 16px 24px;
    font-size: 17px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
    transition: background 0.2s;
  }
  
  .submit-btn:active {
    background: #1e887c;
    transform: scale(0.98);
  }
  
  /* –°–ï–ö–¶–ò–Ø –ü–û–ú–û–©–¨ */
  #help-section {
    background: #f6f1d1;
  }
  
  .help-content {
    max-width: 100%;
    margin: 0 auto;
    background: white;
    padding: 22px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  
  .help-item {
    margin-bottom: 22px;
  }
  
  .help-item h3 {
    color: #26a69a;
    margin-bottom: 10px;
    font-size: 18px;
  }
  
  .help-item p {
    margin: 6px 0;
    line-height: 1.5;
    font-size: 15px;
  }
  
  /* –°–ï–ö–¶–ò–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
  #stats-section {
    background: #f6f1d1;
  }
  
  .stats-container {
    max-width: 100%;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }
  
  .stat-card {
    background: white;
    padding: 18px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    text-align: center;
  }
  
  .stat-number {
    font-size: 28px;
    font-weight: bold;
    color: #26a69a;
    margin: 8px 0;
  }
  
  .stat-label {
    color: #666;
    font-size: 13px;
    line-height: 1.3;
  }
  
  /* –°–¢–ò–õ–ò –î–õ–Ø –î–ï–†–ï–í–ê */
  #tree-container {
    width: 100%;
    height: 100%;
    cursor: move;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .node-group {
    cursor: pointer;
  }
  
  .node-background {
    fill: white;
    stroke: #456d61;
    stroke-width: 1.5px;
    rx: 20px;
    ry: 20px;
    filter: drop-shadow(1px 1px 3px rgba(0,0,0,0.1));
    transition: stroke 0.3s;
  }
  
  .node-background.collapsed {
    stroke: #4CAF50;
  }
  
  .node-background.expanded {
    stroke: #26a69a;
  }
  
  .node-image {
    pointer-events: none;
    user-select: none;
  }
  
  .node-text {
    font-size: 12px;
    pointer-events: none;
    user-select: none;
    fill: #333;
    font-weight: 600;
    text-anchor: start;
    dominant-baseline: central;
  }
  
  .link {
    fill: none;
    stroke: #456d61;
    stroke-width: 1.5px;
    opacity: 0.7;
  }
  
  .floating-btn {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: #ff9800;
    color: white;
    border-radius: 50%;
    width: 56px;
    height: 56px;
    font-size: 30px;
    line-height: 56px;
    text-align: center;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    user-select: none;
    z-index: 100;
    border: none;
    -webkit-tap-highlight-color: transparent;
  }
  
  .floating-btn:active {
    transform: scale(0.95);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  
  /* –ú–ï–î–ò–ê–ó–ê–ü–†–û–°–´ –î–õ–Ø –°–ú–ê–†–¢–§–û–ù–û–í */
  @media (max-width: 768px) {
    header {
      height: 50px;
      padding: 0 8px;
      gap: 6px;
    }
    
    header .icon {
      font-size: 20px;
      padding: 6px;
      min-width: 36px;
    }
    
    .section {
      height: calc(100vh - 50px);
      padding: 12px 8px;
    }
    
    .search-container,
    .add-form,
    .help-content {
      padding: 16px;
    }
    
    .search-box {
      padding: 12px 16px;
      font-size: 15px;
    }
    
    .result-item {
      padding: 12px 10px;
      font-size: 14px;
    }
    
    .form-group input,
    .form-group select {
      padding: 12px;
      font-size: 15px;
    }
    
    .submit-btn {
      padding: 14px 20px;
      font-size: 16px;
    }
    
    .help-item h3 {
      font-size: 17px;
    }
    
    .help-item p {
      font-size: 14px;
    }
    
    .stats-container {
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .stat-card {
      padding: 14px;
    }
    
    .stat-number {
      font-size: 24px;
    }
    
    .stat-label {
      font-size: 12px;
    }
    
    .node-text {
      font-size: 11px;
    }
    
    .floating-btn {
      bottom: 20px;
      right: 20px;
      width: 52px;
      height: 52px;
      font-size: 28px;
      line-height: 52px;
    }
  }
  
  @media (max-width: 480px) {
    header .icon {
      font-size: 18px;
      padding: 5px;
      min-width: 34px;
    }
    
    .stats-container {
      grid-template-columns: 1fr;
      gap: 8px;
    }
    
    .stat-card {
      padding: 12px;
    }
    
    .stat-number {
      font-size: 22px;
    }
    
    .node-text {
      font-size: 10px;
    }
    
    .floating-btn {
      bottom: 16px;
      right: 16px;
      width: 48px;
      height: 48px;
      font-size: 26px;
      line-height: 48px;
    }
  }
  
  /* –°–¢–ò–õ–ò –î–õ–Ø –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–û–ô –û–†–ò–ï–ù–¢–ê–¶–ò–ò */
  @media (max-height: 500px) and (orientation: landscape) {
    header {
      height: 44px;
    }
    
    .section {
      height: calc(100vh - 44px);
      padding: 8px;
    }
    
    #tree-container {
      height: calc(100vh - 60px);
    }
    
    .floating-btn {
      bottom: 12px;
      right: 12px;
      width: 44px;
      height: 44px;
      font-size: 24px;
      line-height: 44px;
    }
  }
</style>
</head>
<body>

<header>
  <div class="icon active" title="–õ—é–¥–∏" data-section="people"><i class="fas fa-users"></i></div>
  <div class="icon" title="–ü–æ–∏—Å–∫" data-section="search"><i class="fas fa-search"></i></div>
  <div class="icon" title="–î–æ–±–∞–≤–∏—Ç—å" data-section="add"><i class="fas fa-user-plus"></i></div>
  <div class="icon" title="–ü–æ–º–æ—â—å" data-section="help"><i class="fas fa-question-circle"></i></div>
  <div class="icon" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" data-section="stats"><i class="fas fa-chart-bar"></i></div>
</header>

<!-- –°–ï–ö–¶–ò–Ø –õ–Æ–î–ò (–î–ï–†–ï–í–û) -->
<div id="people-section" class="section active">
  <div id="tree-container"></div>
  <div class="floating-btn" title="–î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª">+</div>
</div>

<!-- –°–ï–ö–¶–ò–Ø –ü–û–ò–°–ö -->
<div id="search-section" class="section">
  <div class="search-container">
    <input type="text" class="search-box" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∞–º...">
    <div class="search-results">
      <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</h3>
      <div id="search-results-list"></div>
    </div>
  </div>
</div>

<!-- –°–ï–ö–¶–ò–Ø –î–û–ë–ê–í–ò–¢–¨ -->
<div id="add-section" class="section">
  <div class="add-form">
    <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞</h2>
    <div class="form-group">
      <label for="person-name">–ò–º—è:</label>
      <input type="text" id="person-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
    </div>
    <div class="form-group">
      <label for="parent-select">–†–æ–¥–∏—Ç–µ–ª—å:</label>
      <select id="parent-select">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—è</option>
      </select>
    </div>
    <div class="form-group">
      <label for="person-info">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
      <input type="text" id="person-info" placeholder="–ì–æ–¥—ã –∂–∏–∑–Ω–∏, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è...">
    </div>
    <button class="submit-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –¥–µ—Ä–µ–≤–æ</button>
  </div>
</div>

<!-- –°–ï–ö–¶–ò–Ø –ü–û–ú–û–©–¨ -->
<div id="help-section" class="section">
  <div class="help-content">
    <h2>–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –®–µ–∂—ñ—Ä–µ</h2>
    
    <div class="help-item">
      <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–æ–º</h3>
      <p>‚Ä¢ –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫—Ä—É–∂–æ–∫, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å –≤–µ—Ç–∫—É</p>
      <p>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "+" –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</p>
      <p>‚Ä¢ –í—Å–µ —É–∑–ª—ã –º–æ–∂–Ω–æ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å –ø–æ –∫–ª–∏–∫—É</p>
      <p>‚Ä¢ <strong>–ó–∞–∂–º–∏—Ç–µ –ø–∞–ª—å—Ü–µ–º –∏ –¥–≤–∏–≥–∞–π—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–µ—Ä–µ–≤–∞</strong></p>
      <p>‚Ä¢ <strong>–°–≤–æ–¥–∏—Ç–µ/—Ä–∞–∑–≤–æ–¥–∏—Ç–µ –ø–∞–ª—å—Ü—ã –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è/—É–º–µ–Ω—å—à–µ–Ω–∏—è</strong></p>
    </div>
    
    <div class="help-item">
      <h3>üîç –ü–æ–∏—Å–∫</h3>
      <p>‚Ä¢ –í–≤–µ–¥–∏—Ç–µ –∏–º—è –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞</p>
      <p>‚Ä¢ –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —ç—Ç–æ–º—É —á–µ–ª–æ–≤–µ–∫—É –≤ –¥–µ—Ä–µ–≤–µ</p>
    </div>
    
    <div class="help-item">
      <h3>üë§ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª—é–¥–µ–π</h3>
      <p>‚Ä¢ –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –≤ —Ä–∞–∑–¥–µ–ª–µ "–î–æ–±–∞–≤–∏—Ç—å"</p>
      <p>‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—è –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤ –¥–µ—Ä–µ–≤–µ</p>
      <p>‚Ä¢ –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</p>
    </div>
    
    <div class="help-item">
      <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
      <p>‚Ä¢ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∞—à–µ–≥–æ –¥–µ—Ä–µ–≤–∞</p>
      <p>‚Ä¢ –£–∑–Ω–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª—é–¥–µ–π –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö</p>
    </div>
  </div>
</div>

<!-- –°–ï–ö–¶–ò–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
<div id="stats-section" class="section">
  <div class="stats-container">
    <div class="stat-card">
      <h3>–í—Å–µ–≥–æ –ª—é–¥–µ–π</h3>
      <div class="stat-number" id="total-people">0</div>
      <div class="stat-label">–≤ –¥–µ—Ä–µ–≤–µ</div>
    </div>
    
    <div class="stat-card">
      <h3>–£—Ä–æ–≤–Ω–µ–π</h3>
      <div class="stat-number" id="total-levels">0</div>
      <div class="stat-label">–≥–ª—É–±–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞</div>
    </div>
    
    <div class="stat-card">
      <h3>–í–µ—Ç–æ–∫</h3>
      <div class="stat-number" id="total-branches">0</div>
      <div class="stat-label">–æ—Å–Ω–æ–≤–Ω—ã–µ –≤–µ—Ç–≤–∏</div>
    </div>
    
    <div class="stat-card">
      <h3>–õ–∏—Å—Ç—å–µ–≤</h3>
      <div class="stat-number" id="total-leaves">0</div>
      <div class="stat-label">–∫–æ–Ω–µ—á–Ω—ã–µ —É–∑–ª—ã</div>
    </div>
  </div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
  let i = 0;
  
  // ========== –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–• –° TUMALAS.KZ ==========
  let currentTreeData = {
    name: "–ê–ª–∞—à",
    children: [
      { 
        name: "“∞–ª—ã –∂“Ø–∑",
        children: [
          { 
            name: "“ö–∞–Ω–ª—ã",
            children: [
              { 
                name: "“ö–∞–Ω–∫”©–∂–µ–∫",
                children: [
                  { 
                    name: "–ë–∞–π“õ–æ“£—ã—Ä –±–∏",
                    children: [
                      { name: "–ê“õ—ã–ª“õ–æ–∂–∞" },
                      { name: "–´—Ä“ì–∞“õ—Ç—ã" },
                      { 
                        name: "“ö“±–π—ã—Å“õ–∞–Ω–¥—ã",
                        children: [
                          { 
                            name: "–ö–µ–Ω–∂–µ–∞–ª—ã",
                            children: [
                              { name: "–ö“Ø–ª–µ—Å" },
                              { 
                                name: "–ï–º–µ–Ω–¥–µ—Å",
                                children: [
                                  { name: "–ê–π–±–∞—Å" },
                                  { name: "–õ–µ–ø–µ—Å" },
                                  { 
                                    name: "–ù–∞–∑–∞—Ä“õ“±–ª",
                                    children: [
                                      { 
                                        name: "“ö–∞–ª–º–∞–º–±–µ—Ç",
                                        children: [
                                          { 
                                            name: "–ú–∞–Ω–∞—à",
                                            children: [
                                              { name: "–ë–µ—Ä–¥–∞–ª—ã" },
                                              { name: "–°–µ—Ä–¥–∞–ª—ã" },
                                              { 
                                                name: "–°“Ø–≥—ñ—Ä",
                                                children: [
                                                  { name: "–ë–∞—É–±–µ–∫" },
                                                  { 
                                                    name: "“Æ–π—Å—ñ–Ω–±–∞–π",
                                                    children: [
                                                      { name: "–¢“Ø—Å—ñ–ø" },
                                                      { name: "–ñ“Ø–Ω—ñ—Å" },
                                                      { 
                                                        name: "“Æ—Å–µ–Ω",
                                                        children: [
                                                          { name: "–û–º–∞—Ä" },
                                                          { name: "–°—ã–¥—ã“õ" }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  { 
                                                    name: "–ê—Å“õ–∞—Ä",
                                                    children: [
                                                      { 
                                                        name: "–î–∞–±—ã–ª–¥–∞",
                                                        children: [
                                                          { name: "–ê–±–¥–∞–Ω" }
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  { 
                                                    name: "–û—Ä–∞–∑–∞–ª—ã",
                                                    children: [
                                                      { 
                                                        name: "”ò—É–∑–µ–π—ñ—Ç",
                                                        children: [
                                                          { name: "–¢“±—Ä—Å—ã–Ω" }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      { 
                        name: "–¢”ô“£—ñ—Ä–±–µ—Ä–≥–µ–Ω",
                        children: [
                          { 
                            name: "–ë–∞–π—ã—Å–±–∞–π",
                            children: [
                              { name: "–ú–∞–º—ã—Ä–±–∞–π" },
                              { 
                                name: "–ú“Ø—Å—ñ—Ä–µ–ø",
                                children: [
                                  { 
                                    name: "–°–µ—Ä—ñ–∫–±–∞–π",
                                    children: [
                                      { 
                                        name: "–î–æ—Å–∞–π",
                                        children: [
                                          { 
                                            name: "–ë–∞—Ç—ã—Ä–±–µ–∫",
                                            children: [
                                              { name: "–¢“±—Ä–¥—ã“õ“±–ª" },
                                              { 
                                                name: "–¢“±—Ä“ì—ã–Ω",
                                                children: [
                                                  { 
                                                    name: "–ë–∞“õ—ã—Ç–∂–∞–Ω",
                                                    children: [
                                                      { name: "–ë–∞—É—ã—Ä–∂–∞–Ω" },
                                                      { name: "–ú“±—Ä–∞—Ç–±–µ–∫" }
                                                    ]
                                                  },
                                                  { 
                                                    name: "–ë–µ–∫–∂–∞–Ω",
                                                    children: [
                                                      { name: "–ú–µ–¥–µ—É" },
                                                      { name: "–ù“±—Ä–∑–∞—Ç" }
                                                    ]
                                                  },
                                                  { 
                                                    name: "–ï–ª–∂–∞–Ω",
                                                    children: [
                                                      { name: "–ú–µ–π—ñ—Ä–∂–∞–Ω" },
                                                      { name: "–î–æ—Å—ã–º–∂–∞–Ω" },
                                                      { name: "–ï–ª–º–∞—Ä" }
                                                    ]
                                                  }
                                                ]
                                              },
                                              { name: "–¢“±—Ä“ì—ã–Ω”ô–ª—ñ" },
                                              { name: "–®–µ—Ä–∞–ª—ã" },
                                              { name: "–ë–µ—Ä–¥–∞–ª—ã" }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  },
                                  { 
                                    name: "“ö–∞—Ä–∞–±–∞–ª–∞",
                                    children: [
                                      { 
                                        name: "–¢—ã–Ω—ã—à–±–∞–π",
                                        children: [
                                          { name: "”ò–º—ñ—Ä–±–µ–∫" }
                                        ]
                                      }
                                    ]
                                  },
                                  { 
                                    name: "“ö–æ–π–±–∞“ì–∞—Ä",
                                    children: [
                                      { name: "“ö“±—Ä–∞–ª–±–µ–∫" },
                                      { name: "–¢”©–ª–µ–≥–µ–Ω" }
                                    ]
                                  },
                                  { 
                                    name: "–ú–µ–¥–µ—Ç",
                                    children: [
                                      { name: "–ü–∞—Ä–Ω–∞“õ“±–ª" },
                                      { name: "–¢–µ–º—ñ—Ä“õ“±–ª" },
                                      { 
                                        name: "–ú–∞–º—ã—Ä“õ“±–ª",
                                        children: [
                                          { 
                                            name: "–ë–µ—Ä–¥—ñ“õ“±–ª",
                                            children: [
                                              { 
                                                name: "–ñ–∞–ø–ø–∞—Ä",
                                                children: [
                                                  { 
                                                    name: "–ë–∞—Ç—ã—Ä",
                                                    children: [
                                                      { name: "–¢”©–ª–µ–≥–µ–Ω" },
                                                      { name: "–†—É—Å–ª–∞–Ω" },
                                                      { name: "–≠–ª–¥–∞—Ä" }
                                                    ]
                                                  },
                                                  { 
                                                    name: "–ñ”ô–Ω—ñ–±–µ–∫",
                                                    children: [
                                                      { name: "–î–∞–º–∏—Ä" },
                                                      { name: "–ê–π–±–µ–∫" }
                                                    ]
                                                  },
                                                  { 
                                                    name: "–¢–µ–º—ñ—Ä",
                                                    children: [
                                                      { name: "–®—ã“£“ì—ã—Å" },
                                                      { name: "–†–∞–¥–º–∏—Ä" },
                                                      { name: "–°–∞–º–∏—Ä" }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          { 
                                            name: "–ú“±—Ö–∞–º–º–µ–¥",
                                            children: [
                                              { 
                                                name: "–°–º–∞–π—ã–ª",
                                                children: [
                                                  { 
                                                    name: "–ò—Å–∞",
                                                    children: [
                                                      { name: "”ò–ª—ñ—Ö–∞–Ω" },
                                                      { name: "”ò–º—ñ—Ä—Ö–∞–Ω" },
                                                      { name: "”ò—Å—ñ–ª—Ö–∞–Ω" }
                                                    ]
                                                  },
                                                  { 
                                                    name: "–ú–∞—Ä–∞—Ç",
                                                    children: [
                                                      { name: "–¢–µ–º—É—Ä" }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          { 
                                            name: "”ò–±–¥—ñ–ª–∞",
                                            children: [
                                              { 
                                                name: "–ò—Å—Ä–∞–π—ã–ª",
                                                children: [
                                                  { name: "–†–∞—à–∏–¥" }
                                                ]
                                              },
                                              { 
                                                name: "–£—Å–º–∞–Ω",
                                                children: [
                                                  { name: "–ù“±—Ä–ª–∞–Ω" }
                                                ]
                                              },
                                              { 
                                                name: "–°–µ–π—ñ—Ç–∂–∞–Ω",
                                                children: [
                                                  { name: "–ù“±—Ä–∂–∞–Ω" }
                                                ]
                                              },
                                              { 
                                                name: "–ë–∞“õ—ã—Ç",
                                                children: [
                                                  { name: "–ù“±—Ä“ì–∞–ª–∏" },
                                                  { name: "–ù“±—Ä—Å“±–ª—Ç–∞–Ω" }
                                                ]
                                              }
                                            ]
                                          },
                                          { 
                                            name: "–ú–∞—Ö–º“±—Ç",
                                            children: [
                                              { 
                                                name: "–ê–±–∑–∞–ª",
                                                children: [
                                                  { 
                                                    name: "”ò–ª—ñ“õ“±–ª",
                                                    children: [
                                                      { 
                                                        name: "“ö—É–∞–Ω—ã—à",
                                                        children: [
                                                          { name: "–ù“õ–æ–∏—Å–ª–∞–º" }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          },
                                          { 
                                            name: "”®–º—ñ—Ä“õ“±–ª",
                                            children: [
                                              { 
                                                name: "–°–µ—Ä—ñ–∫–±–∞–π",
                                                children: [
                                                  { 
                                                    name: "–ú–∞–ª–∏–∫",
                                                    children: [
                                                      { 
                                                        name: "–ë–µ—Ä—ñ–∫",
                                                        children: [
                                                          { 
                                                            name: "–î–∞–º–∏—Ä",
                                                            children: [
                                                              { name: "–°–∞–º–∏—Ä" }
                                                            ]
                                                          }
                                                        ]
                                                      },
                                                      { name: "–ê–±–∑–∞–ª" }
                                                    ]
                                                  },
                                                  { 
                                                    name: "–°–º–∞–¥–∏—è—Ä",
                                                    children: [
                                                      { 
                                                        name: "–î–∞–Ω–∏—è—Ä",
                                                        children: [
                                                          { name: "–ê—Å“õ–∞—Ä" },
                                                          { name: "–ò–±—Ä–∞—Ö–∏–º" }
                                                        ]
                                                      },
                                                      { 
                                                        name: "–ë–∞—É—ã—Ä–∂–∞–Ω",
                                                        children: [
                                                          { name: "–ê–π–±–∞—Ä" }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      { name: "–¢—ñ–ª–µ—Å" }
                    ]
                  }
                ]
              },
              { name: "“ö–æ–∂–∞ “õ–∞–Ω–ª—ã" },
              { 
                name: "“ö–∞–π—ã “õ–∞“£–ª—ã",
                children: [
                  { name: "C“Ø–ª–µ–π–º–µ–Ω “ì–∞–∑–∏" },
                  { name: "–ï—Ä—Ç“±“ì—Ä—ã–ª “ì–∞–∑–∏" },
                  { name: "–û—Å–º–∞–Ω “ì–∞–∑–∏" }
                ]
              },
              { name: "–ñ—É—Å–∞–Ω–¥—ã" },
              { name: "–ê—à–∞–º–∞–π–ª—ã" },
              { name: "“ö–∞—Ä“õ–∞–ª—ã" },
              { name: "–ï—Ä–≥–µ–Ω–µ–∫—Ç—ñ" },
              { name: "–ë–∞–π—Ç–µ—Ä–µ–∫ –±–∞—Ç—ã—Ä" }
            ]
          },
          { name: "–®–∞–Ω—ã—à“õ—ã–ª—ã" },
          { name: "–°—ñ—Ä–≥–µ–ª—ñ" },
          { name: "–®–∞“õ—à–∞–º" },
          { name: "–°–∞—Ä—ã“Ø–π—Å—ñ–Ω" },
          { name: "–®–∞–ø—ã—Ä–∞—à—Ç—ã" },
          { name: "–ñ–∞–ª–∞–π—ã—Ä" },
          { name: "–´—Å—Ç—ã" },
          { name: "–û—à–∞“õ—Ç—ã" },
          { name: "–ê–ª–±–∞–Ω" },
          { name: "–°—É–∞–Ω" },
          { name: "–î—É–ª–∞—Ç" }
        ]
      },
      { 
        name: "–û—Ä—Ç–∞ –∂“Ø–∑",
        children: [
          { name: "–ê—Ä“ì—ã–Ω" },
          { name: "–ù–∞–π–º–∞–Ω" },
          { name: "“ö–æ–Ω—ã—Ä–∞—Ç" },
          { name: "“ö—ã–ø—à–∞“õ" },
          { name: "–ö–µ—Ä–µ–π" },
          { name: "–£–∞“õ" }
        ]
      },
      { 
        name: "–ö—ñ—à—ñ –∂“Ø–∑",
        children: [
          { name: "“ö–∞–π—ã—Ä–±–∞–π-“ö–∞—Ä–∞–∫–µ—Å–µ–∫" },
          { name: "–ë–∞–π“±–ª—ã" },
          { name: "–ñ–µ—Ç—ñ—Ä—É" }
        ]
      },
      { 
        name: "–ñ“Ø–∑–¥–µ–Ω —Ç—ã—Å",
        children: [
          { name: "–¢”©—Ä–µ" },
          { name: "–¢”©–ª–µ“£–≥—ñ—Ç" },
          { name: "“ö–æ–∂–∞" },
          { name: "–°“±–Ω–∞“õ" },
          { name: "“ö—ã—Ä“ì—ã–∑" },
          { name: "–ù–æ“ì–∞–π-“ö–∞–∑–∞“õ" },
          { name: "–ú–∞“£“ì—ã—Ç" },
          { name: "–ö”©–ª–µ–≥–µ–Ω" },
          { name: "–ö–µ–Ω–µ–≥–µ—Å" },
          { name: "“ö–∏—è—Ç" },
          { name: "---------" }
        ]
      }
    ]
  };

  // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –°–ï–ö–¶–ò–ô ==========
  const sections = document.querySelectorAll('.section');
  const icons = document.querySelectorAll('header .icon');
  
  icons.forEach(icon => {
    icon.addEventListener('click', function() {
      const sectionId = this.getAttribute('data-section');
      
      // –£–±–∏—Ä–∞–µ–º active —É –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫
      icons.forEach(i => i.classList.remove('active'));
      // –î–æ–±–∞–≤–ª—è–µ–º active —Ç–µ–∫—É—â–µ–π –∏–∫–æ–Ω–∫–µ
      this.classList.add('active');
      
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
      sections.forEach(section => section.classList.remove('active'));
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
      document.getElementById(`${sectionId}-section`).classList.add('active');
      
      // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –¥–µ—Ä–µ–≤–æ - –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
      if (sectionId === 'people') {
        setTimeout(initTree, 100);
      }
      
      // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É - –æ–±–Ω–æ–≤–ª—è–µ–º –µ—ë
      if (sectionId === 'stats') {
        updateStatistics();
      }
      
      // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ - –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–æ–¥–∏—Ç–µ–ª–µ–π
      if (sectionId === 'add') {
        updateParentSelect();
      }
    });
  });

  // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ï–†–ï–í–ê ==========
function initTree() {
  const isMobile = window.innerWidth < 768;
  const width = window.innerWidth;
  const height = window.innerHeight - 55;

  d3.select("#tree-container").html("");

  const svg = d3.select("#tree-container")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ –¥–µ—Å–∫—Ç–æ–ø–æ–≤
  const horizontalSpacing = isMobile ? 200 : 300;
  const verticalSpacing = isMobile ? 60 : 80;
  const nodeWidth = isMobile ? 120 : 140;
  const nodeTextOffset = isMobile ? 40 : 50;
  const fontSize = isMobile ? 10 : 12;

  const g = svg.append("g")
    .attr("transform", `translate(${isMobile ? 50 : width / 2 - 300}, 50)`);

  svg.call(
    d3.zoom()
      .scaleExtent([0.1, 4])
      .on("zoom", (event) => g.attr("transform", event.transform))
  ).on("dblclick.zoom", null);

  const treeLayout = d3.tree()
    .nodeSize([verticalSpacing, horizontalSpacing]); // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ

  let root = d3.hierarchy(currentTreeData);

  function collapse(d) {
    if (d.children) {
      d._children = d.children;
      d._children.forEach(collapse);
      d.children = null;
    }
  }

  if (root.children) root.children.forEach(collapse);

  root.x0 = 0;
  root.y0 = 0;

  updateTree(root);

  function updateTree(source) {
    const duration = 400;
    treeLayout(root);

    const nodes = root.descendants();
    const links = root.links();

    const node = g.selectAll("g.node-group")
      .data(nodes, d => d.id || (d.id = ++i));

    /* ===== EXIT ===== */
    node.exit()
      .transition().duration(duration)
      .style("opacity", 0)
      .remove();

    /* ===== ENTER ===== */
    const nodeEnter = node.enter()
      .append("g")
      .attr("class", "node-group")
      .attr("transform", `translate(${source.y0},${source.x0})`)
      .on("click", (e, d) => {
        e.stopPropagation();
        if (d.children) {
          d._children = d.children;
          d.children = null;
        } else {
          d.children = d._children;
          d._children = null;
        }
        updateTree(d);
      });

    nodeEnter.append("rect")
      .attr("class", d => `node-background ${d._children ? 'collapsed' : 'expanded'}`)
      .attr("x", 0)
      .attr("y", -20)
      .attr("height", 40)
      .attr("width", nodeWidth);

    nodeEnter.append("image")
      .attr("x", 8)
      .attr("y", -12)
      .attr("width", 24)
      .attr("height", 24)
      .attr("href", "images/yurt.png")
      .attr("clip-path", "circle(12px at 20px 0)");

    nodeEnter.append("text")
      .attr("class", "node-text")
      .attr("x", nodeTextOffset)
      .attr("y", 0)
      .attr("dy", "0.35em")
      .text(d => d.data.name)
      .style("font-size", fontSize + "px");

    /* ===== UPDATE ===== */
    const nodeUpdate = nodeEnter.merge(node);

    nodeUpdate.transition()
      .duration(duration)
      .attr("transform", d => `translate(${d.y},${d.x})`);

    nodeUpdate.select("rect")
      .transition()
      .duration(duration)
      .attr("width", function () {
        const text = this.parentNode.querySelector("text");
        return Math.max(nodeWidth, text.getBBox().width + (isMobile ? 50 : 70));
      });

    /* ===== LINKS ===== */
    const link = g.selectAll("path.link")
      .data(links, d => d.target.id);

    link.exit()
      .transition().duration(duration)
      .style("opacity", 0)
      .remove();

    link.enter()
      .append("path")
      .attr("class", "link")
      .merge(link)
      .transition()
      .duration(duration)
      .attr("d", d => {
        const sourceRect = d.source.nodeRectWidth || nodeWidth;
        const startX = d.source.y + sourceRect;
        const curveFactor = isMobile ? 40 : 80;
        return `
          M ${startX} ${d.source.x}
          C ${startX + curveFactor} ${d.source.x},
            ${d.target.y - curveFactor} ${d.target.x},
            ${d.target.y} ${d.target.x}
        `;
      });

    nodes.forEach(d => {
      d.x0 = d.x;
      d.y0 = d.y;
      d.nodeRectWidth = d3.select(d3.selectAll(".node-group").nodes()[nodes.indexOf(d)])
        .select("rect").node().getBBox().width;
    });
  }
}

  // ========== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–û–ò–°–ö–ê ==========
  function searchInTree(query) {
    const results = [];
    const searchLower = query.toLowerCase();
    
    function traverse(node, path = []) {
      if (node.data && node.data.name.toLowerCase().includes(searchLower)) {
        results.push({
          name: node.data.name,
          path: [...path, node.data.name].join(' ‚Üí '),
          node: node
        });
      }
      
      if (node.children) {
        node.children.forEach(child => traverse(child, [...path, node.data.name]));
      }
      if (node._children) {
        node._children.forEach(child => traverse(child, [...path, node.data.name]));
      }
    }
    
    const root = d3.hierarchy(currentTreeData);
    traverse(root);
    return results;
  }

  // ========== –ü–û–ò–°–ö ==========
  const searchInput = document.querySelector('.search-box');
  const resultsList = document.getElementById('search-results-list');
  
  searchInput.addEventListener('input', function() {
    const query = this.value.trim();
    
    if (query.length < 2) {
      resultsList.innerHTML = '<p>–í–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞</p>';
      return;
    }
    
    const results = searchInTree(query);
    
    if (results.length === 0) {
      resultsList.innerHTML = '<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
      return;
    }
    
    let html = '';
    results.forEach(result => {
      html += `
        <div class="result-item" data-name="${result.name}">
          <strong>${result.name}</strong>
          <div style="font-size: 12px; color: #666;">${result.path}</div>
        </div>
      `;
    });
    
    resultsList.innerHTML = html;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞
    document.querySelectorAll('.result-item').forEach(item => {
      item.addEventListener('click', function() {
        const name = this.getAttribute('data-name');
        alert(`–ü–µ—Ä–µ—Ö–æ–¥ –∫: ${name}\n(–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–µ—Ä–µ—Ö–æ–¥–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ)`);
      });
    });
  });

  // ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï ==========
  function updateParentSelect() {
    const select = document.getElementById('parent-select');
    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—è</option>';
    
    function addOptions(node, depth = 0) {
      const indent = '‚Äî '.repeat(depth);
      select.innerHTML += `<option value="${node.data.name}">${indent}${node.data.name}</option>`;
      
      if (node.children) {
        node.children.forEach(child => addOptions(child, depth + 1));
      }
    }
    
    const root = d3.hierarchy(currentTreeData);
    addOptions(root);
  }

  const addForm = document.querySelector('.add-form');
  addForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const name = document.getElementById('person-name').value;
    const parent = document.getElementById('parent-select').value;
    const info = document.getElementById('person-info').value;
    
    if (!name) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
      return;
    }
    
    if (!parent) {
      alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—è');
      return;
    }
    
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –¥–µ—Ä–µ–≤–æ
    alert(`–î–æ–±–∞–≤–ª–µ–Ω: ${name}\n–†–æ–¥–∏—Ç–µ–ª—å: ${parent}\n–ò–Ω—Ñ–æ: ${info || '–Ω–µ—Ç'}`);
    
    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
    this.reset();
  });

  // ========== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ==========
  function updateStatistics() {
    function countNodes(node) {
      let total = 1;
      let leaves = 0;
      let maxDepth = 0;
      
      function traverse(n, depth = 0) {
        maxDepth = Math.max(maxDepth, depth);
        
        const hasChildren = (n.children && n.children.length > 0) || 
                          (n._children && n._children.length > 0);
        
        if (!hasChildren) {
          leaves++;
        }
        
        if (n.children) {
          n.children.forEach(child => {
            total++;
            traverse(child, depth + 1);
          });
        }
        if (n._children) {
          n._children.forEach(child => {
            total++;
            traverse(child, depth + 1);
          });
        }
      }
      
      traverse(node);
      
      return {
        total,
        leaves,
        maxDepth,
        branches: node.children ? node.children.length : 0
      };
    }
    
    const root = d3.hierarchy(currentTreeData);
    const stats = countNodes(root);
    
    document.getElementById('total-people').textContent = stats.total;
    document.getElementById('total-levels').textContent = stats.maxDepth + 1;
    document.getElementById('total-branches').textContent = stats.branches;
    document.getElementById('total-leaves').textContent = stats.leaves;
  }

  // ========== –ö–ù–û–ü–ö–ê + ==========
  document.querySelector('.floating-btn').addEventListener('click', function() {
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ —Å–µ–∫—Ü–∏—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    icons.forEach(i => i.classList.remove('active'));
    document.querySelector('[data-section="add"]').classList.add('active');
    
    sections.forEach(s => s.classList.remove('active'));
    document.getElementById('add-section').classList.add('active');
    
    updateParentSelect();
  });

  // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ==========
  document.addEventListener('DOMContentLoaded', function() {
    initTree();
    updateStatistics();
    updateParentSelect();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener('resize', function() {
      if (document.getElementById('people-section').classList.contains('active')) {
        setTimeout(initTree, 100);
      }
    });
  });
</script>
</body>
</html>
